!function(t,n){"object"==typeof exports&&t.require?module.exports=n(require("underscore"),require("d3")):"function"==typeof define&&define.amd?define(["underscore","d3"],function(a,e){return n(a||t._,e||t.d3)}):t.carve=n(_,d3)}(this,function(t,n){function a(a){function r(t,a,e){n.keys(a).forEach(function(n){t[n]=function(r){if(!arguments.length)return a[n];var i=a[n];return a[n]=r,Rn[n].call(Un,{value:r,previous:i}),e[n].call(Un,{value:r,previous:i}),t}})}function i(){s(),w(),rn.enableCarving!==!1&&(j(),nn())}function o(){var t={x:"translate(0,"+vn()+")",y:"translate(0, 0)"},n={x:function(){return"translate("+hn()/2+","+pn()+")"},y:function(){return"translate("+xn()+","+vn()/2+") rotate(90)"}};return null!==sn.select(".axis").node()?s():(["x","y"].forEach(function(a){var e=sn.append("g").attr("class",a+"axis axis");l(a),e.append("g").attr("class","ticks").attr("transform",t[a]).call(qn[a]),e.append("text").style("text-anchor","middle").attr("class","axis_label").attr("transform",n[a]).text(rn.axisLabel[a])}),void 0)}function l(t){var a={y:[0,-1*hn()],x:[0,0]},e=sn.select("."+t+"axis.axis");e.select(".categorical_ticks").remove();var r=n.format(".4r"),i=B(mn[t].domain())&&!K(mn[t].domain())?r:null;if("c"===rn.dataType[t]){var o=e.append("g").attr("class","categorical_ticks"),l=mn[t].range();qn[t].tickSize(a[t][0]).tickPadding(10);var s=mn[t].range(),c=(mn[t].rangeExtent()[1]-mn[t].rangeExtent()[0])/s.length,u=c/2,f=o.selectAll("line").data(l);"y"==t?f.enter().append("line").style("stroke","#888").style("stroke-width","2px").attr("x1",0).attr("x2",hn()).attr("y1",function(t){return t-u}).attr("y2",function(t){return t-u}):f.enter().append("line").style("stroke","#888").style("stroke-width","2px").attr("x1",function(t){return t+u}).attr("x2",function(t){return t+u}).attr("y1",0).attr("y2",vn())}else qn[t].tickSize(a[t][1]);qn[t].tickFormat(i)}function s(){["y","x"].forEach(function(t){var n=sn.select("."+t+"axis.axis");kn[t]=mn[t].copy(),"c"===rn.dataType[t]&&kn[t].domain(mn[t].domain().map(function(n){return u(n,t)})),n.select(".ticks").transition().duration(zn).call(qn[t].scale(kn[t])),l(t)})}function c(){["y","x"].forEach(function(t){var t=sn.select("."+t+"axis");t.selectAll(".tick text").remove(),t.selectAll(".categorical_ticks").remove(),t.selectAll(".axis_label").text("")})}function u(t,n){return n in rn.axisValueDictionary?t in rn.axisValueDictionary[n]?rn.axisValueDictionary[n][t]:t:t}function f(){var t=sn.select(".yaxis"),n=sn.select(".xaxis");t.select(".axis_label").text(rn.axisLabel.y),n.select(".axis_label").text(rn.axisLabel.x)}function d(){rn.axisDomain.y=t.isArray(rn.axisDomain.y)?rn.axisDomain.y:"",rn.axisDomain.x=t.isArray(rn.axisDomain.x)?rn.axisDomain.x:""}function y(n){n.attr("d",Dn(0).size(An)()).style("fill-opacity",function(n){return t.isUndefined(n.splits_on_x)?.8:on(n.splits_on_x)}).style("stroke-width","0px").call(g).transition().duration(zn).attr("transform",function(t){return"translate("+mn.x(t[rn.axisKey.x])+","+mn.y(t[rn.axisKey.y])+")"});var a=un.select(".data_labels").selectAll(".data_totals").data([],String);a.exit().remove()}function p(a){function e(t){"undefined"===t&&(t=void 0);var n=Mn.indexOf(t),a=w/2,e=(n-a)*(k+_*w);return Math.round(e)}function r(){return"M 0 0 L "+b+" 0 L "+b+" 0 L -"+b+" 0 L -"+b+" 0 L 0 0"}function i(t){return"M 0 0 L "+b+" 0 L "+b+" -"+M(t.count/B[t.colorBy]||0)+" L -"+b+" -"+M(t.count/B[t.colorBy])+" L -"+b+" 0 L 0 0"}function o(t){t.style("fill",function(t){return rn.colorFn(t.colorBy)}).attr("d",r).attr("transform",function(t){return"translate("+(mn.x(t.x)+e(String(t.colorBy)))+","+(mn.y(t.y)+g-1)+")"})}function l(t){t.style("fill",function(t){return rn.colorFn(t.colorBy)}).attr("d",i).attr("transform",function(t){return"translate("+(mn.x(t.x)+e(String(t.colorBy)))+","+(mn.y(t.y)+g-1)+")"})}function s(t){return M(t[3])}function c(t){return u(t)?"#fff":"#000"}function u(t){return s(t)>g}function f(t){t.style("fill",c).style("visibility",function(t){return+t[3]<=0?"hidden":null}).attr("transform",function(t){return"translate("+(mn.x(t[0])+e(t[2]))+","+(mn.y(t[1])+g-s(t)+16*u(t)-2)+")"})}a.transition().duration(zn).attr("fill-opacity",0);var d=Mn.length,y="y",p=mn[y].range(),x=(mn[y].rangeExtent()[1]-mn[y].rangeExtent()[0])/p.length,g=x/2,h="x",v=mn[h].range(),m=(mn[h].rangeExtent()[1]-mn[h].rangeExtent()[0])/v.length,k=m/2/d,b=k/2,_=k/d,w=d-1,E={},B={};mn.x.domain().forEach(function(t){E[t]={},mn.y.domain().forEach(function(n){E[t][n]={},Mn.forEach(function(a){E[t][n][a]=0,B[a]=0})})});var K=rn.colorBy.label||"";d>=1?Fn.forEach(function(t){B[t[K]]++,E[t[rn.axisKey.x]][t[rn.axisKey.y]][String(t[K])]++}):B={undefined:Fn.length};var A=[];for(var S in E)for(var T in E[S])for(var D in E[S][T])A.push({x:S,y:T,colorBy:D,count:E[S][T][D]});var M=n.scale.linear().domain([0,1]).rangeRound([0,x]),L=un.select(".bar_surface").selectAll(".bar").data(A,function(n){return JSON.stringify(t.pick(n,"x","y","colorBy"))});L.exit().remove(),L.enter().append("path").attr("class","bar").call(o),L.transition().duration(zn).call(l);var C=t.map(A,function(t){return[t.x,t.y,t.colorBy,t.count/B[t.colorBy]||0]}),F=n.format(".2f"),q=un.select(".data_labels").selectAll(".data_totals").data(C,function(t){return t[0]+"_"+t[1]+"_"+t[2]});q.enter().append("text").style("text-anchor","middle").attr("class","data_totals").attr("transform",function(t){return"translate("+(mn.x(t[0])+e(t[2]))+","+mn.y(t[1])+")"}).text(function(t){return F(t[3])}),q.transition().duration(zn).call(f).text(function(t){return F(t[3])}),q.exit().remove()}function x(){var t,a,e="n"===rn.dataType.x?"x":"y",r=mn[e].domain(),i="x"===e?"y":"x",o=(mn[i].domain().map(String),mn[i].range()),l=(mn[i].rangeExtent()[1]-mn[i].rangeExtent()[0])/o.length,s=n.scale.linear(),c={},u=n.keys(bn);n.keys(bn[u[0]]),u.length&&(u.forEach(function(t){c[t]={},n.keys(bn[t]).forEach(function(n){c[t][n]=F(bn[t][n],r)})}),t=n.values(c).map(function(t){return n.max(n.values(t).map(function(t){return n.max(t,function(t){return t[1]})}))}),a=n.max(t),s=n.scale.linear().domain([0,a]).range([-1*l/2,l/2-10]),"y"===i&&s.range([l/2,-1*l/2+10]));var f=un.select(".kde_surface").selectAll(".kde_group").data(u,String);f.enter().append("g").attr("class","kde_group"),f.transition().duration(zn).attr("transform",function(t){return"translate("+("y"===i?"0, ":"")+mn[i](t)+("x"===i?", 0":"")+")"});var d=f.selectAll(".kde_ensemble").data(function(t){return n.entries(c[t])},function(t){return t.key});d.enter().append("g").attr("class","kde_ensemble").style("fill",function(t){return rn.colorFn(t.key)}).style("fill-opacity",.3);var y=d.selectAll(".kde_plot").data(function(t){return[t.value]},function(t){return t.key}),p=y.enter().append("g").attr("class","kde_plot");p.append("path").attr("class","kde_line").style("fill","none").style("stroke","black"),p.append("path").attr("class","kde_area").style("stroke","none"),d.call(h),y.transition().select(".kde_line").duration(zn).attr("d",n.svg.line()[i](function(t){return s(t[1])})[e](function(t){return mn[e](t[0])}).interpolate("basis")),y.transition().select(".kde_area").duration(zn).attr("d",n.svg.area().interpolate("basis")[e](function(t){return mn[e](t[0])})[i+"0"](s(0))[i+"1"](function(t){return s(t[1])})),y.exit().remove(),d.exit().remove(),f.exit().remove()}function g(t){return t.style("fill",function(t){return rn.colorFn(String(t[rn.colorBy.label]))}).style("fill-opacity",function(t){return rn.highlight&&rn.highlight.length?rn.highlight===String(t[rn.colorBy.label])?.8:0:.5}).style("stroke",null),t}function h(t){t.style("fill-opacity",function(t){return rn.highlight&&rn.highlight.length?rn.highlight===t.key?.8:0:.3})}function v(){var t=un.select(".data").selectAll(".data_point").data([],String);t.exit().remove()}function m(){un.select(".bar_surface").selectAll(".bar").data([],String).exit().remove()}function k(){var t=un.select(".data_labels").selectAll(".data_totals").data([],String);t.exit().remove()}function b(){var t=un.select(".kde_surface").selectAll("g").data([],String);t.exit().remove()}function _(){"cc"!==rn.dataType.mix&&(k(),m()),"nc"!==rn.dataType.mix&&"cn"!==rn.dataType.mix&&b(),"nn"!==rn.dataType.mix&&"cc"!==rn.dataType.mix&&rn.oneDim===!1&&v()}function w(){var t=un.select(".data").selectAll(".data_point").data(Fn,function(t){return t[rn.id]});t.enter().append("path").attr("class","data_point").style("fill","#fff").style("stroke","#fff"),t.exit().transition().duration(zn/2).style("fill-opacity",0).style("stroke-opacity",0).remove(),_(),"nn"===rn.dataType.mix||rn.oneDim===!0?y(t):"n"==rn.dataType.x^"n"==rn.dataType.y?x(t):"cc"===rn.dataType.mix&&p(t)}function E(n){return t.isArray(n)?n.length<=wn?!0:n.some(t.isString)?!0:!1:!1}function B(n){return n.every(t.isNumber)}function K(t){return t.every(function(t){return 0===t%1})}function A(n){return t.every(n,t.isFinite)}function S(){if(rn.data.length<1)return console.log("Empty data array.  Nothing to plot."),{error:!0};var a,e,r=n.keys(rn.data[0]);return rn.oneDim=!1,t.contains(r,rn.id)?(t.contains(r,rn.axisKey.x)||(rn.axisKey.x=rn.id,console.log("carve:  x axis attribute not detected in data. Automatically assigning it to id attribute.")),t.contains(r,rn.axisKey.y)||(rn.axisKey.y=rn.id,console.log("carve:  y axis attribute not detected in data. Automatically assigning it to id attribute.")),t.contains(r,rn.axisKey.x)&&t.contains(r,rn.axisKey.y)&&(a=t.uniq(t.pluck(rn.data,rn.axisKey.x)),e=t.uniq(t.pluck(rn.data,rn.axisKey.y)),rn.dataType.x=E(a)?"c":"n",rn.dataType.y=E(e)?"c":"n",rn.axisKey.x===rn.id&&a.length<11||rn.axisKey.y===rn.id&&e.length<11?rn.oneDim=!0:rn.axisKey.x===rn.id?(rn.axisKey.x="x_dummy",t.forEach(rn.data,function(t){t[rn.axisKey.x]=""}),a=[""],rn.axisLabel.x="Density"):rn.axisKey.y===rn.id&&(rn.axisKey.y="y_dummy",t.forEach(rn.data,function(t){t[rn.axisKey.y]=""}),e=[""],rn.axisLabel.y="Density"),Fn=rn.data),D(a,e),void 0):(console.log("carve: id attribute not detected in data. Specify the id property label in the carve configuration."),void 0)}function T(t,n){var a=t[0],e=t[1],r=e-a||1,i=r*(n-1);return[a-i,e+i]}function D(a,e){var r=t.pluck(Fn,"splits_on_x");on=n.scale.linear().domain(n.extent(r)).range([.2,.9]);var i={x:[0,hn()],y:[vn(),0]},o={x:t.union(a,rn.axisInsistCategoricalValues.x).sort(),y:t.union(e,rn.axisInsistCategoricalValues.y).sort().reverse()};return["x","y"].forEach(function(t){if("c"===rn.dataType[t])mn[t]=n.scale.ordinal().domain(o[t]).rangePoints(i[t],1),mn[t].invert=n.scale.ordinal().domain(mn[t].range()).range(o[t]),_n[t]=[];else{var a=rn.axisDomain[t]||n.extent(o[t]),e=T(a,En);mn[t]=n.scale.linear().domain(e).rangeRound(i[t])}}),rn.dataType.mix=rn.dataType.x+rn.dataType.y,"nc"!==rn.dataType.mix||rn.oneDim?"cn"===rn.dataType.mix&&M("x","y"):M("y","x"),s()}function M(n,a){bn={};var r=[],i=[],o={},l=mn[a].domain()[1]-mn[a].domain()[0],s=l/100,c=[],u={};mn[n].domain().forEach(function(l){if(o={},o[rn.axisKey[n]]=l,i=t.where(rn.data,o),r=t.pluck(i,rn.axisKey[a]),bn[l]={},Mn.forEach(function(n){o={},o[rn.colorBy.label]=Ln?+n:n,c=t.where(i,o),u[n]=t.pluck(c,rn.axisKey[a])}),t.uniq(r).length<=wn);else{var f=e.stats.kde().sample(r).kernel(e.stats.kernel.gaussian),d=f.bandwidth()(r);if(s>d&&(f.bandwidth(s),d=s),Mn.length<=1)return bn[l].all=f,void 0;Mn.forEach(function(t){o={},o[rn.colorBy.label]=t,u[t].length<1||(f=e.stats.kde().sample(u[t]).bandwidth(d).kernel(e.stats.kernel.gaussian),bn[l][t]=f)})}})}function L(a){if(Mn=rn.colorBy.list&&rn.colorBy.list.length?rn.colorBy.list.map(String):[void 0],Ln=A(Mn)?!0:!1,t.isArray(rn.colorBy.colors)&&rn.colorBy.colors.length&&(en=rn.colorBy.colors),a&&a.value.id&&void 0===a.value.label&&(rn.colorBy.label=a.value.id,a.value.label=a.value.id),!a||a.value.label!==a.previous.label||0!==t.difference(a.value.list,a.previous.list).length){var e=Mn.length,r=t.first(en,e)||en[0];rn.colorFn=e?n.scale.ordinal().domain(Mn).range(r):function(){return r}}}function C(){return qn.y.scale(mn.y).tickSize(-1*hn()).ticks(5),qn.x.scale(mn.x).tickSize(2).ticks(5),Un}function F(a,e){var r=[],i=a.sample();if(t.isUndefined(e)&&(e=n.extent(i)),void 0===i)return[];var o=a.bandwidth()(i);return r=n.range(e[0]-2*o,e[1]+2*o,o),a(r)}function q(t,n){mn[n].invert(t),In[n].span=t,nn(),Z(t,n)}function z(n,a){var e=mn[a].domain(),r=mn[a].rangeExtent();t.contains(_n[a],n)||_n[a].push(n);var i=t.difference(e,_n[a]),o=t.union(_n[a],i),l=(r[1]-r[0])/o.length;return i.length<=0?(In[a].span=null,_n[a]=[],void 0):(mn[a].domain(o),mn[a].invert.range(o),In[a].span=mn[a](n)-l/2*("x"===a?-1:1),void 0)}function N(n,a){if(t.contains(_n[a],n)){_n[a]=t.difference(_n[a],[n]);var e=_n[a].length,r=e?t.difference(mn[a].domain(),_n[a]):mn[a].domain(),i=e?t.union(_n[a],r):r,o=(mn[a].rangeExtent()[1]-mn[a].rangeExtent()[0])/i.length;mn[a].domain(i),mn[a].invert.range(i),In[a].span=e?mn[a](_n[a][e-1])-o/2*("x"===a?-1:1):null}}function P(){["x","y"].forEach(function(t){_n[t]="n"===rn.dataType[t]?null:[],V(t)})}function V(n){t.isNull(In[n].span)||(In[n].span=null,nn(),Z(null,n))}function I(n){P();var a=n.value;a.forEach(function(n,a){var e=rn.axisKey.x===a?"x":rn.axisKey.y===a?"y":"";if(!t.isEmpty(e))if(t.isArray(n.values))n.values.forEach(function(t){z(t,e)});else if(t.isFinite(n.high)&&t.isFinite(n.low)){var r=mn[e].domain();n.high===r[1]?q(n.low,e):q(n.high,e)}}),i()}function R(){var n,a,e,r;["x","y"].forEach(function(i){if(void 0!==rn.splits[i]){if(r=In[i].data_array=rn.splits[i].bins,r.length<1||void 0===r[0]||r[0].length<1)return console.error("invalid split bins in axis: "+i),void 0;a=In[i].data_array.length,n=rn.splits[i].low+.5*rn.splits[i].binsize,e=n+(a-1)*rn.splits[i].binsize;var o=r.map(function(t,a){return n+rn.splits[i].binsize*a}),l=mn[i].domain(),s=l[0],c=l[1];r=[];var u=0,f=[];o.forEach(function(t,n){t>=s&&c>=t&&(f[u]=t,r[u]=In[i].data_array[n],u++)}),a=f.length,n=f[0],e=f[a-1],In[i].data_array=a>0?r:void 0,In[i].vis={attr:"x"===i?"d":"stroke",fn:"x"===i?Dn:Cn,"default":"x"===i?Dn(0)():"transparent"},t.isUndefined(In[i].data_array)||U(i,a,n,e)}})}function U(t,a,e,r){var i=In[t].data_array;In[t].opacityScale=n.scale.linear().domain(n.extent(i)).rangeRound([.3,.9]),In[t].colorScale=n.scale.linear().domain(n.extent(i)).range(["#FFEDA0","#F03B20"]),In[t].binScale=n.scale.linear().domain([0,a-1]).rangeRound([mn[t](e),mn[t](r)])}function O(){if(null===sn.select(".split_labels").node()){var t=sn.append("g").attr("class","split_labels");t.append("text").attr("class","x").attr("text-anchor","middle").attr("dy","1em").text(""),t.append("text").attr("class","y").attr("text-anchor","right").attr("dx","0.1em").text("")}}function Z(t,a){var e=n.format(".3f");if(null===t)return sn.select(".split_labels ."+a).text(""),void 0;var r={x:"x"===a?t:0,y:"y"===a?t:0};sn.select(".split_labels ."+a).text(e(mn[a].invert(t))).attr("transform","translate("+r.x+","+r.y+")")}function j(){["x","y"].forEach(function(a){var e=n.select("."+a+".split_group").node();t.isNull(e)&&cn.append("g").attr("class",""+a+" split_group"),"n"===rn.dataType[a]?W(a):H(a)})}function J(){["x","y"].forEach(X)}function X(t){n.select("."+t+".split_group").selectAll("."+t+".split_pointer").transition().duration(zn).style("stroke-opacity",0).remove()}function Y(t){t.style("fill","#eee").style("fill-opacity",.3).style("stroke","#888").style("stroke-width",2)}function G(t,n){var a=(mn[n].domain(),mn[n].range()),e=(mn[n].rangeExtent()[1]-mn[n].rangeExtent()[0])/a.length-10;"x"===n?t.attr("transform",function(t){return"translate("+(mn[n](t)-e/2)+",0)"}).attr("x",0).attr("width",e).attr("y",-12).attr("height",10):t.attr("transform",function(t){return"translate(4,"+(mn[n](t)-e/2+10)+")"}).attr("x",0).attr("width",10).attr("y",0).attr("height",e)}function H(a){var e=cn.select("."+a+".split_group");"y"===a&&e.attr("transform",function(){return"translate("+hn()+",0)"});var r=mn[a].domain(),o=e.selectAll("rect").data(r,String);o.enter().append("rect").call(G,a).call(Y).on("mouseover",function(){n.select(this).style("fill-opacity",1)}).on("mouseout",function(){n.select(this).style("fill-opacity",.3)}).on("click",function(n){t.contains(_n[a],n)?N(n,a):z(n,a),i()}),o.transition().duration(zn).call(G,a),o.exit().remove()}function Q(t,n){var a=mn[n].range();"x"===n?t.attr("x",a[0]).attr("width",a[1]-a[0]).attr("y",-10).attr("height",10):t.attr("x",0).attr("width",10).attr("y",0).attr("height",a[0]-a[1])}function W(t){var a=cn.select("."+t+".split_group");"y"===t&&a.attr("transform",function(){return"translate("+(hn()+4)+",10)"});var e=a.selectAll("rect").data(["ZZZ"],String),r=("y"===t)+0;e.enter().append("rect").call(Q,t).call(Y).on("mouseover",function(){var a=n.mouse(this)[r];null===_n[t]&&q(a,t)}).on("mousemove",$(t)).on("mouseout",function(){null===_n[t]&&V(t)}).on("click",function(){var e=n.mouse(this)[r];q(e,t),null!==_n[t]?(X(t),_n[t]=null):(_n[t]=e,tn(a,t,e))}),e.exit().remove()}function $(t){return function(){var a=n.mouse(this)["x"===t?0:1];null===_n[t]&&q(a,t)}}function tn(t,n,a){"x"===n?t.append("path").attr("class",n+" split_pointer").attr("transform","translate("+a+",0)").attr("d",function(){return"M0,-10v10"}).style("stroke","#cc6432").style("stroke-width",4).style("fill","#cc6432"):t.append("path").attr("class",n+" split_pointer").attr("transform","translate(0,"+a+")").attr("d",function(){return"M0,0h10"}).style("stroke","#cc6432").style("stroke-width",4).style("fill","#cc6432")}function nn(){var a=0,e=[[a,a,In.x.span?In.x.span-a:hn(),In.y.span?In.y.span-a:vn()],[In.x.span?In.x.span:hn(),a,In.x.span?hn()-In.x.span+a:0,In.y.span?In.y.span-a:vn()],[a,In.y.span?In.y.span:vn(),In.x.span?In.x.span-a:hn(),In.y.span?vn()-In.y.span+a:0],[In.x.span?In.x.span:hn(),In.y.span?In.y.span:vn(),In.x.span?hn()-In.x.span+a:0,In.y.span?vn()-In.y.span+a:0]];t.isNull(In.x.span)&&t.isNull(In.y.span)&&(e=[]);var r=fn.selectAll(".partition").data(e);r.enter().append("rect").attr("class","partition").attr("x",function(t){return t[0]}).attr("y",function(t){return t[1]}).attr("width",function(t){return t[2]}).attr("height",function(t){return t[3]}).style("fill",function(t,n){return rn.partitionColors[n]}).style("fill-opacity",.3).style("stroke","none").style("stroke-opacity","0.6").style("stroke-width",4).on("mouseover",function(){n.selectAll(".partition").style("stroke","none"),n.select(this).style("stroke","#22D")}).on("mouseout",function(){var t=n.event.relatedTarget;n.select(t).classed("data_point")||"line"==t.nodeName||n.select(this).style("stroke","none")}).on("click",function(n){var a={};if(!t.isNull(In.x.span))if(a[rn.axisKey.x]={},"n"===rn.dataType.x){var e={low:mn.x.invert(n[0]),high:mn.x.invert(n[2]+n[0])};a[rn.axisKey.x]=t.clone(e)}else{var r=mn.x.range(),i=t.filter(r,function(t){return t>=n[0]&&t<=n[0]+n[2]});a[rn.axisKey.x]={values:i.map(mn.x.invert)}}if(!t.isNull(In.y.span))if(a[rn.axisKey.y]={},"n"===rn.dataType.y){var o={low:mn.y.invert(n[1]+n[3]),high:mn.y.invert(n[1])};a[rn.axisKey.y]=t.clone(o)}else{var l=mn.y.range(),s=l.filter(function(t){return t>=n[1]&&t<=n[1]+n[3]});a[rn.axisKey.y]={values:s.map(mn.y.invert)}}dn.partitioncomplete(a)}),r.attr("x",function(t){return t[0]}).attr("y",function(t){return t[1]}).attr("width",function(t){return t[2]}).attr("height",function(t){return t[3]}),r.exit().transition().duration(100).attr("fill-opacity",0).remove()}var an=a||{},en=["#71C560","#9768C4","#98B8B8","#4F473D","#C1B14C","#B55381"],rn={width:500,height:400,margin:{top:15,bottom:15,left:30,right:10},radius:4,dataType:{x:"n",y:"n",mix:"nn"},data:{x:[],y:[]},id:"id",axisDomain:{x:"",y:""},axisLabel:{x:"X Axis",y:"Y Axis"},axisValueDictionary:{x:{},y:{}},axisKey:{x:null,y:null},axisInsistCategoricalValues:{x:[],y:[]},highlight:null,colorFn:function(){return en[0]},colorBy:{label:"",list:[],colors:en},oneDim:!1,clear:!0,enableCarving:!1,splitColor:"#C1573B",splits:{},partition:{},partitionColors:["#98B8B8","#4F473D","#C1B14C","#B55381"]};t.extend(rn,an);var on,ln,sn,cn,un,fn,dn=n.dispatch.apply(this,["render","resize","highlight","brush","partitioncomplete"].concat(n.keys(rn))),yn=function(){return rn.width-rn.margin.right-rn.margin.left},pn=function(){return rn.height-rn.margin.top-rn.margin.bottom},xn=function(){return yn()-Bn.right-Bn.left},gn=function(){return pn()-Bn.top-Bn.bottom},hn=function(){return xn()-20},vn=function(){return gn()-20},mn={x:n.scale.ordinal(),y:{}},kn={x:mn.x.copy(),y:{}},bn={x:null,y:null},_n={x:null,y:null},wn=4,En=1.04,Bn={top:15,bottom:15,left:30,right:20},Kn=["square","circle","cross","diamond","triangle-down","triangle-up"],An=Math.pow(rn.radius,2),Sn=n.svg.symbol().size(An).type(Kn[0]),Tn=n.scale.ordinal().domain([0,5]).range(Kn),Dn=t.compose(Sn.type,Tn),Mn=[],Ln=!1,Cn=function(t){return Vn[t]},Fn=[],qn={x:n.svg.axis().orient("bottom"),y:n.svg.axis().orient("left")},zn=300,Nn={},Pn={},Vn=["red","green","black"],In={x:{},y:{}},Rn=n.dispatch.apply(this,n.keys(rn)).on("radius",function(){An=Math.pow(rn.radius,2)}).on("data",function(){console.log("carve: data loaded")}).on("colorBy",L).on("splits",R).on("partition",I).on("axisLabel",f).on("axisDomain",d),Un=function(t){t=Un.selection=n.select(t),C(),Un.svg=t.append("div").attr("class","cv_wrapper").append("svg").attr("class","cv").attr("width",rn.width).attr("height",rn.height),Nn.data=t.select("div").append("canvas").attr("class","cv").style("position","absolute").attr("width",hn()).attr("height",vn()).style("left",Bn.left+rn.margin.left+"px").style("top",Bn.top+rn.margin.top+"px").style("z-index",-180)[0][0],Pn.data=Nn.data.getContext("2d");var a=Un.svg.append("defs");a.append("svg:clipPath").attr("id","plot_clip").append("svg:rect").attr("id","clip-rect").attr("x","0").attr("y","0").attr("width",hn()).attr("height",vn()),a.append("svg:clipPath").attr("id","viewbox_clip").append("svg:rect").attr("x","0").attr("y","0").attr("width",yn()).attr("height",pn()),sn=Un.svg.append("g").attr("class","label_surface").attr("transform","translate("+(Bn.left+rn.margin.left+10)+","+(Bn.top+rn.margin.top+10)+")");var e=Un.svg.append("svg").attr("clip","url(#viewbox_clip)").attr("overflow","hidden").attr("x",rn.margin.left).attr("y",rn.margin.top);ln=e.append("g").attr("transform","translate("+Bn.left+","+Bn.top+")"),fn=ln.append("g").attr("transform","translate(10,10)").attr("class","partition_surface");var r=e.append("g").attr("transform","translate("+Bn.left+","+Bn.top+")");return cn=r.append("g").attr("transform","translate(10,0)").attr("class","split_surface"),un=r.append("g").attr("transform","translate(10,10)").attr("clip-path","url(#plot_clip)"),un.append("g").attr("class","kde_surface"),un.append("g").attr("class","bar_surface"),un.append("g").attr("class","data"),un.append("g").attr("class","data_labels"),L(),Un};return Un.toString=function(){return"cv: ("+n.keys(rn.data[0]).length+" total) , "+rn.data.length+" rows"},Un.state=rn,r(Un,rn,dn),n.rebind(Un,dn,"on"),Un.render=function(n){var a=S();return a&&a.error&&a.error===!0||Fn.length<=0?(t.isFunction(n)&&n.call(this,a),this):(w(),void 0!==qn.y.scale()&&o(),t.isObject(In)&&rn.enableCarving&&(P(),J(),j(),O()),rn.clear=!1,t.isFunction(n)&&n.call(this,a),this)},Un.resize=function(){return Un.svg.attr("height",gn()).attr("width",xn()).attr("transform","translate("+rn.margin.left+","+rn.margin.top+")"),this},Un.clear=function(){v(),m(),k(),b(),c()},Un}var e={stats:{}};return e.ascending=function(t,n){return t-n},e.EULER=.5772156649015329,e.expm1=function(t){return 1e-5>t&&t>-1e-5?t+.5*t*t:Math.exp(t)-1},e.functor=function(t){return"function"==typeof t?t:function(){return t}},e.stats.kernel={uniform:function(t){return 1>=t&&t>=-1?.5:0},triangular:function(t){return 1>=t&&t>=-1?1-Math.abs(t):0},epanechnikov:function(t){return 1>=t&&t>=-1?.75*(1-t*t):0},quartic:function(t){if(1>=t&&t>=-1){var n=1-t*t;return.9375*n*n}return 0},triweight:function(t){if(1>=t&&t>=-1){var n=1-t*t;return 35/32*n*n*n}return 0},gaussian:function(t){return 1/Math.sqrt(2*Math.PI)*Math.exp(-.5*t*t)},cosine:function(t){return 1>=t&&t>=-1?Math.PI/4*Math.cos(Math.PI/2*t):0}},e.stats.mean=function(t){var n=t.length;if(0===n)return 0/0;for(var a=0,e=-1;++e<n;)a+=(t[e]-a)/(e+1);return a},e.stats.variance=function(t){var n=t.length;if(1>n)return 0/0;if(1===n)return 0;for(var a=e.stats.mean(t),r=-1,i=0;++r<n;){var o=t[r]-a;i+=o*o}return i/(n-1)},e.stats.quantiles=function(t,n){t=t.slice().sort(e.ascending);var a=t.length-1;return n.map(function(n){if(0===n)return t[0];if(1===n)return t[a];var e=1+n*a,r=Math.floor(e),i=e-r,o=t[r-1];return 0===i?o:o+i*(t[r]-o)})},e.stats.iqr=function(t){var n=e.stats.quantiles(t,[.25,.75]);return n[1]-n[0]},e.stats.bandwidth={nrd0:function(t){var n,a=Math.sqrt(e.stats.variance(t));return(n=Math.min(a,e.stats.iqr(t)/1.34))||(n=a)||(n=Math.abs(t[1]))||(n=1),.9*n*Math.pow(t.length,-.2)},nrd:function(t){var n=e.stats.iqr(t)/1.34;return 1.06*Math.min(Math.sqrt(e.stats.variance(t)),n)*Math.pow(t.length,-0.2)}},e.stats.kde=function(){function t(t){var e=r.call(this,a);return t.map(function(t){for(var r=-1,i=0,o=a.length;++r<o;)i+=n((t-a[r])/e);return[t,i/e/o]})}var n=e.stats.kernel.gaussian,a=[],r=e.stats.bandwidth.nrd;return t.kernel=function(a){return arguments.length?(n=a,t):n},t.sample=function(n){return arguments.length?(a=n,t):a},t.bandwidth=function(n){return arguments.length?(r=e.functor(n),t):r},t},a.version="0.1.6",a});