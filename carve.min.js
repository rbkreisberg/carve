!function(t,n){"object"==typeof exports&&t.require?module.exports=n(require("underscore"),require("d3")):"function"==typeof define&&define.amd?define(["underscore","d3"],function(a,e){return n(a||t._,e||t.d3)}):n(_,d3)}(this,function(t,n){function a(a){function r(t,a,e){n.keys(a).forEach(function(n){t[n]=function(r){if(!arguments.length)return a[n];var i=a[n];return a[n]=r,Pn[n].call(Rn,{value:r,previous:i}),e[n].call(Rn,{value:r,previous:i}),t}})}function i(){s(),_(),en.enableCarving!==!1&&(Z(),tn())}function o(){var t=({x:"M 0 "+(xn()+28)+" L "+yn()+" "+(xn()+28),y:"M 0 "+xn()+" L "+0+" 0"},{x:"translate(0,"+hn()+")",y:"translate(0, 0)"}),n={x:function(){return"translate("+gn()/2+","+pn()+")"},y:function(){return"translate("+yn()+","+hn()/2+") rotate(90)"}};return null!==ln.select(".axis").node()?s():(["x","y"].forEach(function(a){var e=ln.append("g").attr("class",a+"axis axis");l(a),e.append("g").attr("class","ticks").attr("transform",t[a]).call(qn[a]),e.append("text").style("text-anchor","middle").attr("class","axis_label").attr("transform",n[a]).text(en.axisLabel[a])}),void 0)}function l(t){var a={y:[0,-1*gn()],x:[0,0]},e=ln.select("."+t+"axis.axis");e.select(".categorical_ticks").remove();var r=n.format(".4r"),i=E(vn[t].domain())&&!B(vn[t].domain())?r:null;if("c"===en.dataType[t]){var o=e.append("g").attr("class","categorical_ticks"),l=vn[t].range();qn[t].tickSize(a[t][0]);var s=vn[t].range(),c=(vn[t].rangeExtent()[1]-vn[t].rangeExtent()[0])/s.length,u=c/2,f=o.selectAll("line").data(l);"y"==t?f.enter().append("line").style("stroke","#888").style("stroke-width","2px").attr("x1",0).attr("x2",gn()).attr("y1",function(t){return t-u}).attr("y2",function(t){return t-u}):f.enter().append("line").style("stroke","#888").style("stroke-width","2px").attr("x1",function(t){return t+u}).attr("x2",function(t){return t+u}).attr("y1",0).attr("y2",hn())}else qn[t].tickSize(a[t][1]);qn[t].tickFormat(i)}function s(){["y","x"].forEach(function(t){var n=ln.select("."+t+"axis.axis");mn[t]=vn[t].copy(),"c"===en.dataType[t]&&mn[t].domain(vn[t].domain().map(function(n){return c(n,t)})),n.select(".ticks").transition().duration(Fn).call(qn[t].scale(mn[t])),l(t)})}function c(t,n){return n in en.axisValueDictionary?t in en.axisValueDictionary[n]?en.axisValueDictionary[n][t]:t:t}function u(){var t=ln.select(".yaxis"),n=ln.select(".xaxis");t.select(".axis_label").text(en.axisLabel.y),n.select(".axis_label").text(en.axisLabel.x)}function f(){en.axisDomain.y=t.isArray(en.axisDomain.y)?en.axisDomain.y:"",en.axisDomain.x=t.isArray(en.axisDomain.x)?en.axisDomain.x:""}function d(n){n.attr("d",Mn(0).size(Sn)()).style("fill-opacity",function(n){return t.isUndefined(n.splits_on_x)?.8:rn(n.splits_on_x)}).style("stroke-width","0px").call(x).transition().duration(Fn).attr("transform",function(t){return"translate("+vn.x(t[en.axisKey.x])+","+vn.y(t[en.axisKey.y])+")"});var a=cn.select(".data_labels").selectAll(".data_totals").data([],String);a.exit().remove()}function p(a){function e(t){"undefined"===t&&(t=void 0);var n=Kn.indexOf(t),a=w/2,e=(n-a)*(k+_*w);return Math.round(e)}function r(){return"M 0 0 L "+b+" 0 L "+b+" 0 L -"+b+" 0 L -"+b+" 0 L 0 0"}function i(t){return"M 0 0 L "+b+" 0 L "+b+" -"+C(t.count/B[t.colorBy]||0)+" L -"+b+" -"+C(t.count/B[t.colorBy])+" L -"+b+" 0 L 0 0"}function o(t){t.style("fill",function(t){return en.colorFn(t.colorBy)}).attr("d",r).attr("transform",function(t){return"translate("+(vn.x(t.x)+e(String(t.colorBy)))+","+(vn.y(t.y)+g-1)+")"})}function l(t){t.style("fill",function(t){return en.colorFn(t.colorBy)}).attr("d",i).attr("transform",function(t){return"translate("+(vn.x(t.x)+e(String(t.colorBy)))+","+(vn.y(t.y)+g-1)+")"})}function s(t){return C(t[3])}function c(t){return u(t)?"#fff":"#000"}function u(t){return s(t)>g}function f(t){t.style("fill",c).style("visibility",function(t){return+t[3]<=0?"hidden":null}).attr("transform",function(t){return"translate("+(vn.x(t[0])+e(t[2]))+","+(vn.y(t[1])+g-s(t)+20*u(t))+")"})}a.transition().duration(Fn).attr("fill-opacity",0);var d=Kn.length,p="y",y=vn[p].range(),x=(vn[p].rangeExtent()[1]-vn[p].rangeExtent()[0])/y.length,g=x/2,h="x",v=vn[h].range(),m=(vn[h].rangeExtent()[1]-vn[h].rangeExtent()[0])/v.length,k=m/2/d,b=k/2,_=k/d,w=d-1,E={},B={},S={};vn.x.domain().forEach(function(t){E[t]={},vn.y.domain().forEach(function(n){E[t][n]={},Kn.forEach(function(a){E[t][n][a]=0,S[a]=B[a]=0})})});var T=en.colorBy.label||"";d>=1?Dn.forEach(function(t){B[t[T]]++,E[t[en.axisKey.x]][t[en.axisKey.y]][String(t[T])]++>=S[t[T]]&&(S[t[T]]=E[t[en.axisKey.x]][t[en.axisKey.y]][String(t[T])])}):B={undefined:Dn.length};var A=[];for(var M in E)for(var K in E[M])for(var L in E[M][K])A.push({x:M,y:K,colorBy:L,count:E[M][K][L]});var C=n.scale.linear().domain([0,1]).rangeRound([0,x]),D=cn.select(".bar_surface").selectAll(".bar").data(A,function(n){return JSON.stringify(t.pick(n,"x","y","colorBy"))});D.exit().remove(),D.enter().append("path").attr("class","bar").call(o),D.transition().duration(Fn).call(l);var q=t.map(A,function(t){return[t.x,t.y,t.colorBy,t.count/B[t.colorBy]||0]}),F=n.format(".2f"),z=cn.select(".data_labels").selectAll(".data_totals").data(q,function(t){return t[0]+"_"+t[1]+"-"+t[2]});z.enter().append("text").style("text-anchor","middle").attr("class","data_totals").attr("transform",function(t){return"translate("+(vn.x(t[0])+e(t[2]))+","+vn.y(t[1])+")"}).text(function(t){return F(t[3])}),z.transition().duration(Fn).call(f).text(function(t){return F(t[3])}),z.exit().remove()}function y(){var t,a,e="n"===en.dataType.x?"x":"y",r=vn[e].domain(),i="x"===e?"y":"x",o=(vn[i].domain().map(String),vn[i].range()),l=(vn[i].rangeExtent()[1]-vn[i].rangeExtent()[0])/o.length,s=n.scale.linear(),c={},u=n.keys(kn);n.keys(kn[u[0]]),u.length&&(u.forEach(function(t){c[t]={},n.keys(kn[t]).forEach(function(n){c[t][n]=D(kn[t][n],r)})}),t=n.values(c).map(function(t){return n.max(n.values(t).map(function(t){return n.max(t,function(t){return t[1]})}))}),a=n.max(t),s=n.scale.linear().domain([0,a]).range([-1*l/2,l/2-10]),"y"===i&&s.range([l/2,-1*l/2+10]));var f=cn.select(".kde_surface").selectAll(".kde_group").data(u,String);f.enter().append("g").attr("class","kde_group"),f.transition().duration(Fn).attr("transform",function(t){return"translate("+("y"===i?"0, ":"")+vn[i](t)+("x"===i?", 0":"")+")"});var d=f.selectAll(".kde_ensemble").data(function(t){return n.entries(c[t])},function(t){return t.key});d.enter().append("g").attr("class","kde_ensemble").style("fill",function(t){return en.colorFn(t.key)}).style("fill-opacity",.3);var p=d.selectAll(".kde_plot").data(function(t){return[t.value]},function(t){return t.key}),y=p.enter().append("g").attr("class","kde_plot");y.append("path").attr("class","kde_line").style("fill","none").style("stroke","black"),y.append("path").attr("class","kde_area").style("stroke","none"),d.call(g),p.transition().select(".kde_line").duration(Fn).attr("d",n.svg.line()[i](function(t){return s(t[1])})[e](function(t){return vn[e](t[0])}).interpolate("basis")),p.transition().select(".kde_area").duration(Fn).attr("d",n.svg.area().interpolate("basis")[e](function(t){return vn[e](t[0])})[i+"0"](s(0))[i+"1"](function(t){return s(t[1])})),p.exit().remove(),d.exit().remove(),f.exit().remove()}function x(t){return t.style("fill",function(t){return en.colorFn(String(t[en.colorBy.label]))}).style("fill-opacity",function(t){return en.highlight&&en.highlight.length?en.highlight===String(t[en.colorBy.label])?.8:0:.5}).style("stroke",null),t}function g(t){t.style("fill-opacity",function(t){return en.highlight&&en.highlight.length?en.highlight===t.key?.8:0:.3})}function h(){var t=cn.select(".data").selectAll(".data_point").data([],String);t.exit().remove()}function v(){cn.select(".bar_surface").selectAll(".bar").data([],String).exit().remove()}function m(){var t=cn.select(".data_labels").selectAll(".data_totals").data([],String);t.exit().remove()}function k(){var t=cn.select(".kde_surface").selectAll("g").data([],String);t.exit().remove()}function b(){"cc"!==en.dataType.mix&&(m(),v()),"nc"!==en.dataType.mix&&"cn"!==en.dataType.mix&&k(),"nn"!==en.dataType.mix&&"cc"!==en.dataType.mix&&h()}function _(){var t=cn.select(".data").selectAll(".data_point").data(Dn,function(t){return t[en.id]});t.enter().append("path").attr("class","data_point").style("fill","#fff").style("stroke","#fff"),t.exit().transition().duration(Fn/2).style("fill-opacity",0).style("stroke-opacity",0).remove(),b(),"nn"===en.dataType.mix?d(t):"n"==en.dataType.x^"n"==en.dataType.y?y(t):"cc"===en.dataType.mix&&p(t)}function w(n){return t.isArray(n)?n.length<=_n?!0:n.some(t.isString)?!0:!1:!1}function E(n){return n.every(t.isNumber)}function B(t){return t.every(function(t){return 0===t%1})}function S(n){return t.every(n,t.isFinite)}function T(){if(en.data.length<1)return console.log("Empty data array.  Nothing to plot."),void 0;var a=n.keys(en.data[0]);if(t.contains(a,en.axisKey.x)&&t.contains(a,en.axisKey.y)){var e=t.uniq(t.pluck(en.data,en.axisKey.x)),r=t.uniq(t.pluck(en.data,en.axisKey.y));en.dataType.x=w(e)?"c":"n",en.dataType.y=w(r)?"c":"n",Dn=en.data,M(e,r)}else console.error("x or y coordinates not packaged in data")}function A(t,n){var a=t[0],e=t[1],r=e-a||1,i=r*(n-1);return[a-i,e+i]}function M(a,e){var r=t.pluck(Dn,"splits_on_x");rn=n.scale.linear().domain(n.extent(r)).range([.2,.9]);var i={x:[0,gn()],y:[hn(),0]},o={x:t.union(a,en.axisInsistCategoricalValues.x).sort(),y:t.union(e,en.axisInsistCategoricalValues.y).sort().reverse()};return["x","y"].forEach(function(t){if("c"===en.dataType[t])vn[t]=n.scale.ordinal().domain(o[t]).rangePoints(i[t],1),vn[t].invert=n.scale.ordinal().domain(vn[t].range()).range(o[t]),bn[t]=[];else{var a=en.axisDomain[t]||n.extent(o[t]),e=A(a,wn);vn[t]=n.scale.linear().domain(e).rangeRound(i[t])}}),en.dataType.mix=en.dataType.x+en.dataType.y,"nc"===en.dataType.mix?K("y","x"):"cn"===en.dataType.mix&&K("x","y"),s()}function K(n,a){kn={};var r=[],i=[],o={},l=vn[a].domain()[1]-vn[a].domain()[0],s=l/100,c=[],u={};vn[n].domain().forEach(function(l){if(o={},o[en.axisKey[n]]=l,i=t.where(en.data,o),r=t.pluck(i,en.axisKey[a]),kn[l]={},Kn.forEach(function(n){o={},o[en.colorBy.label]=Ln?+n:n,c=t.where(i,o),u[n]=t.pluck(c,en.axisKey[a])}),t.uniq(r).length<=_n);else{var f=e.stats.kde().sample(r).kernel(e.stats.kernel.gaussian),d=f.bandwidth()(r);if(s>d&&(f.bandwidth(s),d=s),Kn.length<=1)return kn[l].all=f,void 0;Kn.forEach(function(t){o={},o[en.colorBy.label]=t,u[t].length<1||(f=e.stats.kde().sample(u[t]).bandwidth(d).kernel(e.stats.kernel.gaussian),kn[l][t]=f)})}})}function L(a){if(Kn=en.colorBy.list&&en.colorBy.list.length?en.colorBy.list.map(String):[void 0],Ln=S(Kn)?!0:!1,t.isArray(en.colorBy.colors)&&en.colorBy.colors.length&&(an=en.colorBy.colors),a&&a.value.id&&void 0===a.value.label&&(en.colorBy.label=a.value.id,a.value.label=a.value.id),!a||a.value.label!==a.previous.label||0!==t.difference(a.value.list,a.previous.list).length){var e=Kn.length,r=t.first(an,e)||an[0];en.colorFn=e?n.scale.ordinal().domain(Kn).range(r):function(){return r}}}function C(){return qn.y.scale(vn.y).tickSize(-1*gn()).ticks(5),qn.x.scale(vn.x).tickSize(2).ticks(5),Rn}function D(a,e){var r=[],i=a.sample();if(t.isUndefined(e)&&(e=n.extent(i)),void 0===i)return[];var o=a.bandwidth()(i);return r=n.range(e[0]-2*o,e[1]+2*o,o),a(r)}function q(t,n){vn[n].invert(t),In[n].span=t,tn(),O(t,n)}function F(n,a){var e=vn[a].domain(),r=vn[a].rangeExtent();t.contains(bn[a],n)||bn[a].push(n);var i=t.difference(e,bn[a]),o=t.union(bn[a],i),l=(r[1]-r[0])/o.length;return i.length<=0?(In[a].span=null,bn[a]=[],void 0):(vn[a].domain(o),vn[a].invert.range(o),In[a].span=vn[a](n)-l/2*("x"===a?-1:1),void 0)}function z(n,a){if(t.contains(bn[a],n)){bn[a]=t.difference(bn[a],[n]);var e=bn[a].length,r=e?t.difference(vn[a].domain(),bn[a]):vn[a].domain(),i=e?t.union(bn[a],r):r,o=(vn[a].rangeExtent()[1]-vn[a].rangeExtent()[0])/i.length;vn[a].domain(i),vn[a].invert.range(i),In[a].span=e?vn[a](bn[a][e-1])-o/2*("x"===a?-1:1):null}}function N(){["x","y"].forEach(function(t){bn[t]="n"===en.dataType[t]?null:[],V(t)})}function V(n){t.isNull(In[n].span)||(In[n].span=null,tn(),O(null,n))}function I(n){N();var a=n.value;a.forEach(function(n,a){var e=en.axisKey.x===a?"x":en.axisKey.y===a?"y":"";if(!t.isEmpty(e))if(t.isArray(n.values))n.values.forEach(function(t){F(t,e)});else if(t.isFinite(n.high)&&t.isFinite(n.low)){var r=vn[e].domain();n.high===r[1]?q(n.low,e):q(n.high,e)}}),i()}function P(){var n,a,e,r;["x","y"].forEach(function(i){if(void 0!==en.splits[i]){if(r=In[i].data_array=en.splits[i].bins,r.length<1||void 0===r[0]||r[0].length<1)return console.error("invalid split bins in axis: "+i),void 0;a=In[i].data_array.length,n=en.splits[i].low+.5*en.splits[i].binsize,e=n+(a-1)*en.splits[i].binsize;var o=r.map(function(t,a){return n+en.splits[i].binsize*a}),l=vn[i].domain(),s=l[0],c=l[1];r=[];var u=0,f=[];o.forEach(function(t,n){t>=s&&c>=t&&(f[u]=t,r[u]=In[i].data_array[n],u++)}),a=f.length,n=f[0],e=f[a-1],In[i].data_array=a>0?r:void 0,In[i].vis={attr:"x"===i?"d":"stroke",fn:"x"===i?Mn:Cn,"default":"x"===i?Mn(0)():"transparent"},t.isUndefined(In[i].data_array)||R(i,a,n,e)}})}function R(t,a,e,r){var i=In[t].data_array;In[t].opacityScale=n.scale.linear().domain(n.extent(i)).rangeRound([.3,.9]),In[t].colorScale=n.scale.linear().domain(n.extent(i)).range(["#FFEDA0","#F03B20"]),In[t].binScale=n.scale.linear().domain([0,a-1]).rangeRound([vn[t](e),vn[t](r)])}function U(){if(null===ln.select(".split_labels").node()){var t=ln.append("g").attr("class","split_labels");t.append("text").attr("class","x").attr("text-anchor","middle").attr("dy","1em").text(""),t.append("text").attr("class","y").attr("text-anchor","right").attr("dx","0.1em").text("")}}function O(t,a){var e=n.format(".3f");if(null===t)return ln.select(".split_labels ."+a).text(""),void 0;var r={x:"x"===a?t:0,y:"y"===a?t:0};ln.select(".split_labels ."+a).text(e(vn[a].invert(t))).attr("transform","translate("+r.x+","+r.y+")")}function Z(){["x","y"].forEach(function(a){var e=n.select("."+a+".split_group").node();t.isNull(e)&&sn.append("g").attr("class",""+a+" split_group"),"n"===en.dataType[a]?Q(a):G(a)})}function j(){["x","y"].forEach(J)}function J(t){n.select("."+t+".split_group").selectAll("."+t+".split_pointer").transition().duration(Fn).style("stroke-opacity",0).remove()}function X(t){t.style("fill","#eee").style("fill-opacity",.3).style("stroke","#888").style("stroke-width",2)}function Y(t,n){var a=(vn[n].domain(),vn[n].range()),e=(vn[n].rangeExtent()[1]-vn[n].rangeExtent()[0])/a.length-10;"x"===n?t.attr("transform",function(t){return"translate("+(vn[n](t)-e/2)+",0)"}).attr("x",0).attr("width",e).attr("y",-12).attr("height",10):t.attr("transform",function(t){return"translate(4,"+(vn[n](t)-e/2+10)+")"}).attr("x",0).attr("width",10).attr("y",0).attr("height",e)}function G(a){var e=sn.select("."+a+".split_group");"y"===a&&e.attr("transform",function(){return"translate("+gn()+",0)"});var r=vn[a].domain(),o=e.selectAll("rect").data(r,String);o.enter().append("rect").call(Y,a).call(X).on("mouseover",function(){n.select(this).style("fill-opacity",1)}).on("mouseout",function(){n.select(this).style("fill-opacity",.3)}).on("click",function(n){t.contains(bn[a],n)?z(n,a):F(n,a),i()}),o.transition().duration(Fn).call(Y,a),o.exit().remove()}function H(t,n){var a=vn[n].range();"x"===n?t.attr("x",a[0]).attr("width",a[1]-a[0]).attr("y",-10).attr("height",10):t.attr("x",0).attr("width",10).attr("y",0).attr("height",a[0]-a[1])}function Q(t){var a=sn.select("."+t+".split_group");"y"===t&&a.attr("transform",function(){return"translate("+(gn()+4)+",10)"});var e=a.selectAll("rect").data(["ZZZ"],String),r=("y"===t)+0;e.enter().append("rect").call(H,t).call(X).on("mouseover",function(){var a=n.mouse(this)[r];null===bn[t]&&q(a,t)}).on("mousemove",W(t)).on("mouseout",function(){null===bn[t]&&V(t)}).on("click",function(){var e=n.mouse(this)[r];q(e,t),null!==bn[t]?(J(t),bn[t]=null):(bn[t]=e,$(a,t,e))}),e.exit().remove()}function W(t){return function(){var a=n.mouse(this)["x"===t?0:1];null===bn[t]&&q(a,t)}}function $(t,n,a){"x"===n?t.append("path").attr("class",n+" split_pointer").attr("transform","translate("+a+",0)").attr("d",function(){return"M0,-10v10"}).style("stroke","#cc6432").style("stroke-width",4).style("fill","#cc6432"):t.append("path").attr("class",n+" split_pointer").attr("transform","translate(0,"+a+")").attr("d",function(){return"M0,0h10"}).style("stroke","#cc6432").style("stroke-width",4).style("fill","#cc6432")}function tn(){var a=0,e=[[a,a,In.x.span?In.x.span-a:gn(),In.y.span?In.y.span-a:hn()],[In.x.span?In.x.span:gn(),a,In.x.span?gn()-In.x.span+a:0,In.y.span?In.y.span-a:hn()],[a,In.y.span?In.y.span:hn(),In.x.span?In.x.span-a:gn(),In.y.span?hn()-In.y.span+a:0],[In.x.span?In.x.span:gn(),In.y.span?In.y.span:hn(),In.x.span?gn()-In.x.span+a:0,In.y.span?hn()-In.y.span+a:0]];t.isNull(In.x.span)&&t.isNull(In.y.span)&&(e=[]);var r=un.selectAll(".partition").data(e);r.enter().append("rect").attr("class","partition").attr("x",function(t){return t[0]}).attr("y",function(t){return t[1]}).attr("width",function(t){return t[2]}).attr("height",function(t){return t[3]}).style("fill",function(t,n){return en.partitionColors[n]}).style("fill-opacity",.3).style("stroke","none").style("stroke-opacity","0.6").style("stroke-width",4).on("mouseover",function(){n.selectAll(".partition").style("stroke","none"),n.select(this).style("stroke","#22D")}).on("mouseout",function(){var t=n.event.relatedTarget;n.select(t).classed("data_point")||"line"==t.nodeName||n.select(this).style("stroke","none")}).on("click",function(n){var a={};if(!t.isNull(In.x.span))if(a[en.axisKey.x]={},"n"===en.dataType.x){var e={low:vn.x.invert(n[0]),high:vn.x.invert(n[2]+n[0])};a[en.axisKey.x]=t.clone(e)}else{var r=vn.x.range(),i=t.filter(r,function(t){return t>=n[0]&&t<=n[0]+n[2]});a[en.axisKey.x]={values:i.map(vn.x.invert)}}if(!t.isNull(In.y.span))if(a[en.axisKey.y]={},"n"===en.dataType.y){var o={low:vn.y.invert(n[1]+n[3]),high:vn.y.invert(n[1])};a[en.axisKey.y]=t.clone(o)}else{var l=vn.y.range(),s=l.filter(function(t){return t>=n[1]&&t<=n[1]+n[3]});a[en.axisKey.y]={values:s.map(vn.y.invert)}}fn.partitioncomplete(a)}),r.attr("x",function(t){return t[0]}).attr("y",function(t){return t[1]}).attr("width",function(t){return t[2]}).attr("height",function(t){return t[3]}),r.exit().transition().duration(100).attr("fill-opacity",0).remove()}var nn=a||{},an=["#71C560","#9768C4","#98B8B8","#4F473D","#C1B14C","#B55381"],en={width:500,height:400,margin:{top:15,bottom:15,left:30,right:10},radius:4,dataType:{x:"n",y:"n",mix:"nn"},data:{x:[],y:[]},id:"id",axisDomain:{x:"",y:""},axisLabel:{x:"X Axis",y:"Y Axis"},axisValueDictionary:{x:{},y:{}},axisKey:{x:"x",y:"y"},axisInsistCategoricalValues:{x:[],y:[]},highlight:null,colorFn:function(){return an[0]},colorBy:{label:"",list:[],colors:an},clear:!0,enableCarving:!1,splitColor:"#C1573B",splits:{},partition:{},partitionColors:["#98B8B8","#4F473D","#C1B14C","#B55381"]};t.extend(en,nn);var rn,on,ln,sn,cn,un,fn=n.dispatch.apply(this,["render","resize","highlight","brush","partitioncomplete"].concat(n.keys(en))),dn=function(){return en.width-en.margin.right-en.margin.left},pn=function(){return en.height-en.margin.top-en.margin.bottom},yn=function(){return dn()-En.right-En.left},xn=function(){return pn()-En.top-En.bottom},gn=function(){return yn()-20},hn=function(){return xn()-20},vn={x:n.scale.ordinal(),y:{}},mn={x:vn.x.copy(),y:{}},kn={x:null,y:null},bn={x:null,y:null},_n=4,wn=1.04,En={top:15,bottom:15,left:30,right:20},Bn=["square","circle","cross","diamond","triangle-down","triangle-up"],Sn=Math.pow(en.radius,2),Tn=n.svg.symbol().size(Sn).type(Bn[0]),An=n.scale.ordinal().domain([0,5]).range(Bn),Mn=t.compose(Tn.type,An),Kn=[],Ln=!1,Cn=function(t){return Vn[t]},Dn=[],qn={x:n.svg.axis().orient("bottom"),y:n.svg.axis().orient("left")},Fn=300,zn={},Nn={},Vn=["red","green","black"],In={x:{},y:{}},Pn=n.dispatch.apply(this,n.keys(en)).on("radius",function(){Sn=Math.pow(en.radius,2)}).on("data",function(){console.log("carve: data loaded")}).on("colorBy",L).on("splits",P).on("partition",I).on("axisLabel",u).on("axisDomain",f),Rn=function(t){t=Rn.selection=n.select(t),C(),Rn.svg=t.append("div").attr("class","cv_wrapper").append("svg").attr("class","cv").attr("width",en.width).attr("height",en.height),zn.data=t.select("div").append("canvas").attr("class","cv").style("position","absolute").attr("width",gn()).attr("height",hn()).style("left",En.left+en.margin.left+"px").style("top",En.top+en.margin.top+"px").style("z-index",-180)[0][0],Nn.data=zn.data.getContext("2d");var a=Rn.svg.append("defs");a.append("svg:clipPath").attr("id","plot_clip").append("svg:rect").attr("id","clip-rect").attr("x","0").attr("y","0").attr("width",gn()).attr("height",hn()),a.append("svg:clipPath").attr("id","viewbox_clip").append("svg:rect").attr("x","0").attr("y","0").attr("width",dn()).attr("height",pn()),ln=Rn.svg.append("g").attr("class","label_surface").attr("transform","translate("+(En.left+en.margin.left+10)+","+(En.top+en.margin.top+10)+")");var e=Rn.svg.append("svg").attr("clip","url(#viewbox_clip)").attr("overflow","hidden").attr("x",en.margin.left).attr("y",en.margin.top);on=e.append("g").attr("transform","translate("+En.left+","+En.top+")"),un=on.append("g").attr("transform","translate(10,10)").attr("class","partition_surface");var r=e.append("g").attr("transform","translate("+En.left+","+En.top+")");return sn=r.append("g").attr("transform","translate(10,0)").attr("class","split_surface"),cn=r.append("g").attr("transform","translate(10,10)").attr("clip-path","url(#plot_clip)"),cn.append("g").attr("class","kde_surface"),cn.append("g").attr("class","bar_surface"),cn.append("g").attr("class","data"),cn.append("g").attr("class","data_labels"),L(),Rn};return Rn.toString=function(){return"cv: ("+n.keys(en.data[0]).length+" total) , "+en.data.length+" rows"},Rn.state=en,r(Rn,en,fn),n.rebind(Rn,fn,"on"),Rn.render=function(){return T(),Dn.length<=0?void 0:(_(),void 0!==qn.y.scale()&&o(),t.isObject(In)&&en.enableCarving&&(N(),j(),Z(),U()),en.clear=!1,this)},Rn.resize=function(){return Rn.svg.attr("height",xn()).attr("width",yn()).attr("transform","translate("+en.margin.left+","+en.margin.top+")"),this},Rn}var e={stats:{}};return e.ascending=function(t,n){return t-n},e.EULER=.5772156649015329,e.expm1=function(t){return 1e-5>t&&t>-1e-5?t+.5*t*t:Math.exp(t)-1},e.functor=function(t){return"function"==typeof t?t:function(){return t}},e.stats.kernel={uniform:function(t){return 1>=t&&t>=-1?.5:0},triangular:function(t){return 1>=t&&t>=-1?1-Math.abs(t):0},epanechnikov:function(t){return 1>=t&&t>=-1?.75*(1-t*t):0},quartic:function(t){if(1>=t&&t>=-1){var n=1-t*t;return.9375*n*n}return 0},triweight:function(t){if(1>=t&&t>=-1){var n=1-t*t;return 35/32*n*n*n}return 0},gaussian:function(t){return 1/Math.sqrt(2*Math.PI)*Math.exp(-.5*t*t)},cosine:function(t){return 1>=t&&t>=-1?Math.PI/4*Math.cos(Math.PI/2*t):0}},e.stats.mean=function(t){var n=t.length;if(0===n)return 0/0;for(var a=0,e=-1;++e<n;)a+=(t[e]-a)/(e+1);return a},e.stats.variance=function(t){var n=t.length;if(1>n)return 0/0;if(1===n)return 0;for(var a=e.stats.mean(t),r=-1,i=0;++r<n;){var o=t[r]-a;i+=o*o}return i/(n-1)},e.stats.quantiles=function(t,n){t=t.slice().sort(e.ascending);var a=t.length-1;return n.map(function(n){if(0===n)return t[0];if(1===n)return t[a];var e=1+n*a,r=Math.floor(e),i=e-r,o=t[r-1];return 0===i?o:o+i*(t[r]-o)})},e.stats.iqr=function(t){var n=e.stats.quantiles(t,[.25,.75]);return n[1]-n[0]},e.stats.bandwidth={nrd0:function(t){var n,a=Math.sqrt(e.stats.variance(t));return(n=Math.min(a,e.stats.iqr(t)/1.34))||(n=a)||(n=Math.abs(t[1]))||(n=1),.9*n*Math.pow(t.length,-.2)},nrd:function(t){var n=e.stats.iqr(t)/1.34;return 1.06*Math.min(Math.sqrt(e.stats.variance(t)),n)*Math.pow(t.length,-0.2)}},e.stats.kde=function(){function t(t){var e=r.call(this,a);return t.map(function(t){for(var r=-1,i=0,o=a.length;++r<o;)i+=n((t-a[r])/e);return[t,i/e/o]})}var n=e.stats.kernel.gaussian,a=[],r=e.stats.bandwidth.nrd;return t.kernel=function(a){return arguments.length?(n=a,t):n},t.sample=function(n){return arguments.length?(a=n,t):a},t.bandwidth=function(n){return arguments.length?(r=e.functor(n),t):r},t},a.version="0.1.2",a});